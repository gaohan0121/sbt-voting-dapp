(()=>{"use strict";var e={4445:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(124),a=n(8534),u=n(1832),s=n.n(u);const i=JSON.parse('{"Mt":[{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"delegate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string[]","name":"proposalNames","type":"string[]"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"DelegateSuccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"host","type":"address"},{"indexed":false,"internalType":"address[]","name":"voters","type":"address[]"}],"name":"MandateSuccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sbtContract","type":"address"}],"name":"SBTContractSet","type":"event"},{"inputs":[{"internalType":"address","name":"sbtAddr","type":"address"}],"name":"setSBTContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"idx","type":"uint256"}],"name":"vote","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"voter","type":"address"},{"indexed":true,"internalType":"uint256","name":"targetId","type":"uint256"}],"name":"VoteSuccess","type":"event"},{"inputs":[],"name":"getBoardInfo","outputs":[{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"voteCount","type":"uint256"}],"internalType":"struct Ballot.Proposal[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hasSBT","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"host","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isSBTSet","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"proposals","outputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"voteCount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"sbtContract","outputs":[{"internalType":"contract IVotingSBT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"voters","outputs":[{"internalType":"uint256","name":"weight","type":"uint256"},{"internalType":"bool","name":"voted","type":"bool"},{"internalType":"address","name":"delegate","type":"address"},{"internalType":"uint256","name":"vote","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"winnerName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"winningProposal","outputs":[{"internalType":"uint256","name":"winningProposal_","type":"uint256"}],"stateMutability":"view","type":"function"}]}');var o=[{inputs:[{internalType:"address",name:"",type:"address"}],name:"hasSBT",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"}],name:"issueSBT",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"recipients",type:"address[]"}],name:"batchIssueSBT",outputs:[],stateMutability:"nonpayable",type:"function"}],l="0x5C1181Ab2320cF2Bf7a87f04335c79D1Fa88352d",p="0x632d4D026f4F5f2bFfc66506b354d3D277aB447b",c="0xaa36a7",d=function(){var e=new(s())(s().givenProvider);if(!s().givenProvider)return console.error("未检测到 Web3 Provider (如 MetaMask)。"),{web3:null,voteContract:null,sbtContract:null,contractAddrress:l,getAccount:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()};var t=new e.eth.Contract(i.Mt,l),n=new e.eth.Contract(o,p),u=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(){var n,a,u;return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(window.ethereum){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,e.eth.requestAccounts();case 4:return n=t.sent,t.next=7,e.eth.getChainId();case 7:if(a=t.sent,a===BigInt(c)){t.next=23;break}return t.prev=9,t.next=12,window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:c}]});case 12:return t.next=14,e.eth.requestAccounts();case 14:return u=t.sent,t.abrupt("return",u[0]);case 18:return t.prev=18,t.t0=t["catch"](9),console.error("切换网络失败:",t.t0),4902===t.t0.code&&alert("请在 MetaMask 中添加 Sepolia 测试网。"),t.abrupt("return",n[0]);case 23:return t.abrupt("return",n[0]);case 24:case"end":return t.stop()}}),t,null,[[9,18]])})));return function(){return t.apply(this,arguments)}}();return{web3:e,voteContract:t,sbtContract:n,contractAddrress:l,sbtContractAddress:p,getAccount:u}};const f=d},7387:(e,t,n)=>{n(6992),n(8674),n(9601),n(7727);var r=n(5010),a=n(5258),u=(n(8386),n(4521)),s=(n(5086),n(3396)),i=n(4870),o=function(e){return(0,s.dD)("data-v-3f2d1c88"),e=e(),(0,s.Cn)(),e},l=o((function(){return(0,s._)("nav",{class:"header"},"去中心化投票APP",-1)}));const p={__name:"App",setup:function(e){var t=(0,i.iH)(0);return function(e,n){var r=(0,s.up)("router-view"),i=u.QP,o=a.Er;return(0,s.wg)(),(0,s.iD)("div",null,[l,(0,s._)("main",null,[(0,s.Wm)(r)]),(0,s.Wm)(o,{route:"",modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=function(e){return t.value=e}),"active-color":"#ee742f"},{default:(0,s.w5)((function(){return[(0,s.Wm)(i,{to:"/",icon:"gem-o"},{default:(0,s.w5)((function(){return[(0,s.Uk)("分发票权")]})),_:1}),(0,s.Wm)(i,{to:"/account",icon:"balance-list-o"},{default:(0,s.w5)((function(){return[(0,s.Uk)("账户信息")]})),_:1}),(0,s.Wm)(i,{to:"/board",icon:"orders-o"},{default:(0,s.w5)((function(){return[(0,s.Uk)("投票看板")]})),_:1})]})),_:1},8,["modelValue"])])}}};var c=n(89);const d=(0,c.Z)(p,[["__scopeId","data-v-3f2d1c88"]]),f=d;n(1539),n(8783),n(3948);var y=n(2483),v=n(9545),m=(n(2332),n(5331)),b=(n(9041),n(1471)),h=(n(7603),n(2229)),w=(n(8228),n(2691)),g=(n(1209),n(4361)),T=(n(1323),n(124)),x=n(8534),C=(n(6755),n(7327),n(1249),n(3210),n(7139)),k=n(4445),S=n(4816),_={class:"box"},B=(0,s._)("h2",null,"Host 授权操作 (Host Only)",-1),M=(0,s._)("p",{class:"label"},"主持人地址:",-1),A={class:"address"},W=(0,s._)("p",{class:"label"},"当前连接账户:",-1),F={class:"address"},Z=(0,s._)("p",{class:"label"},"Ballot 合约地址:",-1),O={class:"address"},D=(0,s._)("p",{class:"label"},"Ballot 绑定的SBT地址:",-1),P={class:"address"},E={key:0,style:{"text-align":"center",padding:"20px"}},L={key:1},V={class:"btn-box"},j={key:0,style:{color:"green","text-align":"center","margin-top":"10px"}},N={class:"btn-box"},U={key:2,style:{"text-align":"center",color:"red",padding:"20px"}},z={key:0},I={key:1},H={key:2};const q={__name:"MandateView",setup:function(e){var t=(0,k.Z)(),n=t.web3,r=t.voteContract,a=t.getAccount,u=t.sbtContract,o=t.contractAddrress,l=(0,i.iH)(""),p=(0,i.iH)(""),c=(0,i.iH)(""),d=(0,i.iH)(""),f=(0,i.iH)(!0),y=function(){var e=(0,x.Z)((0,T.Z)().mark((function e(){return(0,T.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return f.value=!0,e.next=3,a();case 3:if(p.value=e.sent,r){e.next=7;break}return f.value=!1,e.abrupt("return");case 7:return e.prev=7,e.next=10,r.methods.host().call();case 10:return l.value=e.sent,e.next=13,r.methods.sbtContract().call();case 13:c.value=e.sent,e.next=20;break;case 16:e.prev=16,e.t0=e["catch"](7),console.error("获取主持人地址失败:",e.t0),(0,S.CF)("获取合约信息失败，请检查 ABI 和网络。",{type:"fail",duration:5e3});case 20:return e.prev=20,f.value=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,16,20,23]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=(0,x.Z)((0,T.Z)().mark((function e(){var t;return(0,T.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(c.value&&n.utils.isAddress(c.value)){e.next=2;break}return e.abrupt("return",(0,S.CF)("请输入有效的 SBT 合约地址"));case 2:if(p.value.toLowerCase()===l.value.toLowerCase()){e.next=4;break}return e.abrupt("return",(0,S.CF)("只有主持人才能设置 SBT 合约地址！",{type:"fail"}));case 4:return t=null,e.prev=5,t=(0,S.CF)({type:"loading",message:"正在设置合约地址...",forbidClick:!0,duration:0}),e.next=9,r.methods.setSBTContract(c.value).send({from:p.value});case 9:t&&t.close(),(0,S.CF)("SBT 合约地址设置成功！",{type:"success"}),e.next=18;break;case 13:e.prev=13,e.t0=e["catch"](5),console.error("设置 SBT 合约地址失败:",e.t0),t&&t.close(),(0,S.CF)("设置 SBT 合约地址失败: 合约已回滚 (可能地址已设置)。",{type:"fail",duration:5e3});case 18:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=(0,x.Z)((0,T.Z)().mark((function e(){var t,r;return(0,T.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(u){e.next=2;break}return e.abrupt("return",(0,S.CF)("SBT合约未初始化。请检查 useWeb3.js 文件。",{type:"fail"}));case 2:if(p.value.toLowerCase()===l.value.toLowerCase()){e.next=4;break}return e.abrupt("return",(0,S.CF)("只有主持人才能批量分发 SBT！",{type:"fail"}));case 4:if(t=[],e.prev=5,t=d.value.startsWith("[")?JSON.parse(d.value):d.value.split(",").map((function(e){return e.trim()})).filter((function(e){return n.utils.isAddress(e)})),0!==t.length){e.next=9;break}return e.abrupt("return",(0,S.CF)("地址列表为空或格式不正确！",{type:"fail"}));case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e["catch"](5),e.abrupt("return",(0,S.CF)("地址列表格式解析失败！",{type:"fail"}));case 14:return r=null,e.prev=15,r=(0,S.CF)({type:"loading",message:"正在发送批量分发交易...",forbidClick:!0,duration:0}),e.next=19,u.methods.batchIssueSBT(t).send({from:p.value});case 19:r&&r.close(),(0,S.CF)("批量分发 SBT 成功！",{type:"success"}),e.next=28;break;case 23:e.prev=23,e.t1=e["catch"](15),console.error("批量分发 SBT 失败 (可能权限不足或 EVM 回滚):",e.t1),r&&r.close(),(0,S.CF)("批量分发 SBT 失败。请检查：1. 当前账户是否为 SBT 合约 Owner。 2. 地址列表是否正确。",{type:"fail",duration:5e3});case 28:case"end":return e.stop()}}),e,null,[[5,11],[15,23]])})));return function(){return e.apply(this,arguments)}}();return(0,s.bv)((0,x.Z)((0,T.Z)().mark((function e(){return(0,T.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:case"end":return e.stop()}}),e)})))),function(e,t){var n=g.T,r=w.iz,a=h.gb,u=b.gN,y=m.TS,T=v.zx;return(0,s.wg)(),(0,s.iD)("div",_,[B,(0,s.Wm)(n,{direction:"vertical",fill:""},{default:(0,s.w5)((function(){return[(0,s.Wm)(n,null,{default:(0,s.w5)((function(){return[M,(0,s._)("p",A,(0,C.zw)(l.value||"加载中..."),1)]})),_:1}),(0,s.Wm)(n,null,{default:(0,s.w5)((function(){return[W,(0,s._)("p",F,(0,C.zw)(p.value||"加载中..."),1)]})),_:1}),(0,s.Wm)(n,null,{default:(0,s.w5)((function(){return[Z,(0,s._)("p",O,(0,C.zw)((0,i.SU)(o)||"加载中..."),1)]})),_:1}),(0,s.Wm)(n,null,{default:(0,s.w5)((function(){return[D,(0,s._)("p",P,(0,C.zw)(c.value||"未设置"),1)]})),_:1})]})),_:1}),(0,s.Wm)(r),f.value?((0,s.wg)(),(0,s.iD)("div",E,[(0,s.Wm)(a,{type:"spinner",size:"24px"},{default:(0,s.w5)((function(){return[(0,s.Uk)("正在加载权限信息...")]})),_:1})])):p.value&&l.value&&p.value.toLowerCase()===l.value.toLowerCase()?((0,s.wg)(),(0,s.iD)("div",L,[(0,s.Wm)(r,null,{default:(0,s.w5)((function(){return[(0,s.Uk)("步骤 1: 绑定 SBT 合约地址")]})),_:1}),(0,s.Wm)(y,{inset:""},{default:(0,s.w5)((function(){return[(0,s.Wm)(u,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=function(e){return c.value=e}),rows:"1",autosize:"",label:"SBT 合约地址",type:"textarea",placeholder:"请输入您部署的 VotingSBT 合约地址"},null,8,["modelValue"])]})),_:1}),(0,s._)("div",V,[(0,s.Wm)(T,{type:"primary",size:"large",disabled:c.value&&"0x0000000000000000000000000000000000000000"!==c.value.toLowerCase(),onClick:q},{default:(0,s.w5)((function(){return[(0,s.Uk)(" 设置 SBT 合约地址 (Host Only) ")]})),_:1},8,["disabled"]),c.value&&"0x0000000000000000000000000000000000000000"!==c.value.toLowerCase()?((0,s.wg)(),(0,s.iD)("p",j,"✅ 地址已设置，无需重复操作。")):(0,s.kq)("",!0)]),(0,s.Wm)(r,null,{default:(0,s.w5)((function(){return[(0,s.Uk)("步骤 2: 批量分发 SBT 身份")]})),_:1}),(0,s.Wm)(y,{inset:""},{default:(0,s.w5)((function(){return[(0,s.Wm)(u,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return d.value=e}),rows:"3",autosize:"",label:"投票人地址列表",type:"textarea",placeholder:"请输入投票人地址，多个地址用逗号分隔，例如：0x123..., 0x456... (请使用测试网地址)"},null,8,["modelValue"])]})),_:1}),(0,s._)("div",N,[(0,s.Wm)(T,{type:"warning",size:"large",onClick:J,disabled:!c.value||"0x0000000000000000000000000000000000000000"===c.value.toLowerCase()},{default:(0,s.w5)((function(){return[(0,s.Uk)(" 批量分发 SBT (铸造 SBT) ")]})),_:1},8,["disabled"])])])):((0,s.wg)(),(0,s.iD)("div",U,[p.value&&l.value?((0,s.wg)(),(0,s.iD)("p",z,"您不是主持人，无法进行授权操作。")):p.value?((0,s.wg)(),(0,s.iD)("p",H,"权限信息异常。")):((0,s.wg)(),(0,s.iD)("p",I,"请连接钱包。"))]))])}}},J=q,K=J;var Q=[{path:"/",name:"home",component:K},{path:"/account",name:"account",component:function(){return n.e(809).then(n.bind(n,4200))}},{path:"/board",name:"board",component:function(){return n.e(198).then(n.bind(n,2530))}}],G=(0,y.p7)({history:(0,y.r5)(),routes:Q});const R=G;(0,r.ri)(f).use(R).mount("#app")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var u=t[r]={id:r,loaded:!1,exports:{}};return e[r](u,u.exports,n),u.loaded=!0,u.exports}n.m=e,(()=>{var e=[];n.O=(t,r,a,u)=>{if(!r){var s=1/0;for(p=0;p<e.length;p++){for(var[r,a,u]=e[p],i=!0,o=0;o<r.length;o++)(!1&u||s>=u)&&Object.keys(n.O).every((e=>n.O[e](r[o])))?r.splice(o--,1):(i=!1,u<s&&(s=u));if(i){e.splice(p--,1);var l=a();void 0!==l&&(t=l)}}return t}u=u||0;for(var p=e.length;p>0&&e[p-1][2]>u;p--)e[p]=e[p-1];e[p]=[r,a,u]}})(),(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return n.d(t,{a:t}),t}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[]))})(),(()=>{n.u=e=>"js/"+{198:"board",809:"account"}[e]+"."+{198:"ba338f20",809:"22c90019"}[e]+".js"})(),(()=>{n.miniCssF=e=>"css/"+{198:"board",809:"account"}[e]+"."+{198:"091eb7b0",809:"9e0bb225"}[e]+".css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="web3-vote:";n.l=(r,a,u,s)=>{if(e[r])e[r].push(a);else{var i,o;if(void 0!==u)for(var l=document.getElementsByTagName("script"),p=0;p<l.length;p++){var c=l[p];if(c.getAttribute("src")==r||c.getAttribute("data-webpack")==t+u){i=c;break}}i||(o=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+u),i.src=r),e[r]=[a];var d=(t,n)=>{i.onerror=i.onload=null,clearTimeout(f);var a=e[r];if(delete e[r],i.parentNode&&i.parentNode.removeChild(i),a&&a.forEach((e=>e(n))),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),o&&document.head.appendChild(i)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{n.p="/sbt-voting-dapp/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,n,r,a)=>{var u=document.createElement("link");u.rel="stylesheet",u.type="text/css";var s=n=>{if(u.onerror=u.onload=null,"load"===n.type)r();else{var s=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.href||t,o=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");o.code="CSS_CHUNK_LOAD_FAILED",o.type=s,o.request=i,u.parentNode.removeChild(u),a(o)}};return u.onerror=u.onload=s,u.href=t,n?n.parentNode.insertBefore(u,n.nextSibling):document.head.appendChild(u),u},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var a=n[r],u=a.getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(u===e||u===t))return a}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){a=s[r],u=a.getAttribute("data-href");if(u===e||u===t)return a}},r=r=>new Promise(((a,u)=>{var s=n.miniCssF(r),i=n.p+s;if(t(s,i))return a();e(r,i,null,a,u)})),a={143:0};n.f.miniCss=(e,t)=>{var n={198:1,809:1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=r(e).then((()=>{a[e]=0}),(t=>{throw delete a[e],t})))}}})(),(()=>{var e={143:0};n.f.j=(t,r)=>{var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var u=new Promise(((n,r)=>a=e[t]=[n,r]));r.push(a[2]=u);var s=n.p+n.u(t),i=new Error,o=r=>{if(n.o(e,t)&&(a=e[t],0!==a&&(e[t]=void 0),a)){var u=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+u+": "+s+")",i.name="ChunkLoadError",i.type=u,i.request=s,a[1](i)}};n.l(s,o,"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,r)=>{var a,u,[s,i,o]=r,l=0;if(s.some((t=>0!==e[t]))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(o)var p=o(n)}for(t&&t(r);l<s.length;l++)u=s[l],n.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return n.O(p)},r=self["webpackChunkweb3_vote"]=self["webpackChunkweb3_vote"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n.O(void 0,[998],(()=>n(7387)));r=n.O(r)})();
//# sourceMappingURL=app.614e5fa4.js.map