{"version":3,"file":"js/account.a944108f.js","mappings":"2cAOA,OAAwDA,EAAAA,EAAAA,KAAhDC,EAAI,EAAJA,KAAMC,EAAY,EAAZA,aAAcC,EAAU,EAAVA,WAAYC,EAAW,EAAXA,YAElCC,GAAUC,EAAAA,EAAAA,IAAI,IAEdC,GAAYD,EAAAA,EAAAA,IAAI,CACpBE,OAAQ,EACRC,SAAU,6CACVC,OAAO,EACPC,KAAM,IAIFC,GAAmBN,EAAAA,EAAAA,IAAI,IAGvBO,GAAaP,EAAAA,EAAAA,KAAI,GAGjBQ,GAAiBC,EAAAA,EAAAA,KAAS,WAC9B,OAAKR,EAAUS,MAAMP,UAAyC,+CAA7BF,EAAUS,MAAMP,SAG1CF,EAAUS,MAAMP,SAFd,KAGX,IAEMQ,GAAgBF,EAAAA,EAAAA,KAAS,WAC7B,OAAOR,EAAUS,MAAMN,MAAQ,IAAM,GACvC,IAIMQ,EAAW,yCAAG,oGACMf,IAAY,OAArB,GAAbE,EAAQW,MAAQ,EAAH,KACRX,EAAQW,OAAUd,EAAY,0EAIPA,EAAaiB,QAAQC,OAAOf,EAAQW,OAAOK,OAAM,OAA1D,GAAfd,EAAUS,MAAQ,EAAH,MAEXZ,EAAa,CAAF,iCACcA,EAAYe,QAAQG,OAAOjB,EAAQW,OAAOK,OAAM,QAAzER,EAAWG,MAAQ,EAAH,kEAIpBO,QAAQC,MAAM,YAAa,EAAF,IAAS,0DAEzC,kBAfgB,mCAkBXf,EAAQ,yCAAG,6FACRI,EAAWG,MAAO,CAAF,yCACVS,EAAAA,EAAAA,IAAU,uBAAqB,UAGrCxB,GAASW,EAAiBI,OAAUf,EAAKyB,MAAMC,UAAUf,EAAiBI,OAAM,0CAC1ES,EAAAA,EAAAA,IAAU,iBAAe,OAW7B,OARHG,EAAe,KAAI,SAGnBA,GAAeH,EAAAA,EAAAA,IAAU,CACrBI,KAAM,UACNC,QAAS,cACTC,aAAa,EACbC,SAAU,IACX,SAEG9B,EAAaiB,QACdV,SAASG,EAAiBI,OAE1BiB,KAAK,CACFC,KAAM7B,EAAQW,MACdmB,IAAK,YACP,OAIN,OAFIP,GAAcA,EAAaQ,SAC/BX,EAAAA,EAAAA,IAAU,SACV,UACMP,IAAa,6DAGnBK,QAAQC,MAAM,QAAS,EAAF,IACjBI,GAAcA,EAAaQ,SAC/BX,EAAAA,EAAAA,IAAU,sBAAsB,0DAEvC,kBArCa,mC,OAwCdY,EAAAA,EAAAA,KAAS,uBAAC,oGACFnB,IAAa,4C,ywDC9FfoB,EAAc,EAEpB,G","sources":["webpack://web3-vote/./src/views/AccountView.vue","webpack://web3-vote/./src/views/AccountView.vue?adce"],"sourcesContent":["<script setup>\nimport { ref, onMounted, computed } from \"vue\";\nimport { showToast } from \"vant\"; \n// üö® ÂÅáËÆæ useWeb3 Â∑≤ÁªèÂØºÂá∫‰∫Ü sbtContract ÂÆû‰æã\nimport useWeb3 from \"@/hooks/useWeb3\";\n\n// ‚ö†Ô∏è Ê≥®ÊÑèÔºöËøôÈáåÂÅáËÆæ useWeb3 Â∑≤ÁªèÈõÜÊàê‰∫Ü sbtContract\nconst { web3, voteContract, getAccount, sbtContract } = useWeb3();\n\nconst account = ref(\"\");\n// ÈÄâÊ∞ë‰ø°ÊÅØÔºåÂØπÂ∫î Solidity ÁöÑ Voter ÁªìÊûÑ‰Ωì\nconst voterInfo = ref({\n  weight: 0,\n  delegate: '0x0000000000000000000000000000000000000000',\n  voted: false,\n  vote: 0,\n});\n\n// ÂèóÊâò‰∫∫Âú∞ÂùÄ\nconst delegatorAddress = ref(\"\");\n\n// SBT ÁªëÂÆöÁä∂ÊÄÅ\nconst isSbtBound = ref(false);\n\n// Ê†ºÂºèÂåñÂêéÁöÑ‰ø°ÊÅØÊòæÁ§∫\nconst delegateStatus = computed(() => {\n  if (!voterInfo.value.delegate || voterInfo.value.delegate === '0x0000000000000000000000000000000000000000') {\n    return 'Êú™ÂßîÊâò';\n  }\n  return voterInfo.value.delegate;\n});\n\nconst isVotedStatus = computed(() => {\n  return voterInfo.value.voted ? 'ÊòØ' : 'Âê¶';\n});\n\n\n// 1. Ëé∑ÂèñÈÄâÊ∞ë‰ø°ÊÅØ (ÂåÖÂê´Á•®Êï∞„ÄÅÂßîÊâò„ÄÅÊäïÁ•®Áä∂ÊÄÅ)\nconst getVoteInfo = async () => {\n    account.value = await getAccount();\n    if (!account.value || !voteContract) return;\n\n    try {\n        // 1.1 Ëé∑ÂèñÊäïÁ•®ÂêàÁ∫¶‰ø°ÊÅØ\n        voterInfo.value = await voteContract.methods.voters(account.value).call();\n        // 1.2 Ê£ÄÊü• SBT ÁªëÂÆöÁä∂ÊÄÅ\n        if (sbtContract) {\n            isSbtBound.value = await sbtContract.methods.hasSBT(account.value).call();\n        }\n\n    } catch(error) {\n        console.error(\"Ëé∑ÂèñÈÄâÊ∞ë‰ø°ÊÅØÂ§±Ë¥•:\", error);\n    }\n};\n\n// 3. ÂßîÊâòÂáΩÊï∞\nconst delegate = async () => {\n    if (!isSbtBound.value) {\n        return showToast(\"ËØ∑ÂÖàÁªëÂÆö SBT Ë∫´‰ªΩÊâçËÉΩËøõË°åÂßîÊâòÔºÅ\");\n    }\n    // Á°Æ‰øù web3 ÂØπË±°Â∑≤Âä†ËΩΩ‰∏îÂú∞ÂùÄÊúâÊïà\n    if (!web3 || !delegatorAddress.value || !web3.utils.isAddress(delegatorAddress.value)) {\n        return showToast(\"ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂèóÊâò‰∫∫Âú∞ÂùÄÔºÅ\");\n    }\n\n    let loadingToast = null;\n    try {\n        // üöÄ ‰øÆÊ≠£ 1: Vant Toast ÂÖºÂÆπÊÄß\n        loadingToast = showToast({ \n            type: 'loading',\n            message: 'Ê≠£Âú®ÂèëÈÄÅÂßîÊâò‰∫§Êòì...', \n            forbidClick: true,\n            duration: 0,\n        });\n        \n        await voteContract.methods\n            .delegate(delegatorAddress.value)\n            // üöÄ ‰øÆÊ≠£ 2: Gas Limit ËøáÈ´òÈóÆÈ¢ò\n            .send({ \n                from: account.value,\n                gas: '3000000' // ËÆæÁΩÆÂêàÁêÜÁöÑ Gas Limit\n            });\n            \n        if (loadingToast) loadingToast.close();\n        showToast('ÂßîÊâòÊàêÂäüÔºÅ');\n        // Âà∑Êñ∞‰ø°ÊÅØ\n        await getVoteInfo();\n\n    } catch(error) {\n        console.error(\"ÂßîÊâòÂ§±Ë¥•:\", error);\n        if (loadingToast) loadingToast.close();\n        showToast('ÂßîÊâòÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•‰∫§ÊòìÊó•ÂøóÊàñÂßîÊâòÁéØË∑Ø„ÄÇ');\n    }\n};\n\n\nonMounted(async () => {\n  await getVoteInfo();\n});\n</script>\n\n<template>\n  <div class=\"box2\">\n    <van-divider>Ë¥¶Êà∑‰ø°ÊÅØ</van-divider>\n    <van-space direction=\"vertical\" fill>\n        <van-cell-group inset>\n            <van-cell title=\"ÂΩìÂâçË¥¶Êà∑\" :value=\"account\" />\n            <van-cell title=\"SBT ÁªëÂÆöÁä∂ÊÄÅ\">\n                <template #value>\n                    <van-tag :type=\"isSbtBound ? 'success' : 'danger'\">\n                        {{ isSbtBound ? 'Â∑≤ÁªëÂÆö' : 'Êú™ÁªëÂÆö' }}\n                    </van-tag>\n                </template>\n            </van-cell>\n            <van-cell title=\"Ë¥¶Êà∑Á•®Êï∞ (weight)\" :value=\"voterInfo.weight\" />\n            \n            <van-cell title=\"ÂßîÊâòË¥¶Êà∑ (delegate)\">\n                 <template #value>\n                    <p class=\"address\">{{ delegateStatus }}</p>\n                 </template>\n            </van-cell>\n\n            <van-cell title=\"ÊòØÂê¶Â∑≤ÊäïÁ•® (voted)\" :value=\"isVotedStatus\" />\n\n            <van-cell v-if=\"voterInfo.voted\" title=\"Â∑≤ÊäïÊèêÊ°àID (vote)\" :value=\"voterInfo.vote\" />\n        </van-cell-group>\n\n    </van-space>\n    \n    <van-divider>ÂßîÊâòÊäïÁ•®</van-divider>\n    \n    <van-cell-group inset>\n      <van-field\n        v-model=\"delegatorAddress\"\n        rows=\"1\"\n        autosize\n        label=\"ÂèóÊâò‰∫∫Âú∞ÂùÄ\"\n        type=\"textarea\"\n        placeholder=\"ËØ∑ËæìÂÖ•ÂèóÊâò‰∫∫ÁöÑÈí±ÂåÖÂú∞ÂùÄ\"\n      />\n    </van-cell-group>\n    \n    <div class=\"btn-box\">\n      <van-button \n         type=\"primary\" \n         size=\"large\" \n         :disabled=\"voterInfo.voted || !isSbtBound\"\n         @click=\"delegate\"\n      >\n        ÂßîÊâòÊäïÁ•®\n      </van-button>\n      <p style=\"color: red; text-align: center; margin-top: 10px;\" v-if=\"voterInfo.voted\">üö® ÊÇ®Â∑≤ÊäïÁ•®ÔºåÊó†Ê≥ïÂÜçÂßîÊâò„ÄÇ</p>\n      <p style=\"color: red; text-align: center; margin-top: 10px;\" v-else-if=\"!isSbtBound\">üö® ËØ∑ÂÖàÁªëÂÆö SBT Ë∫´‰ªΩÊâçËÉΩËøõË°åÂßîÊâò„ÄÇ</p>\n    </div>\n  </div>\n</template>\n\n<style lang=\"less\"></style>","import script from \"./AccountView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./AccountView.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useWeb3","web3","voteContract","getAccount","sbtContract","account","ref","voterInfo","weight","delegate","voted","vote","delegatorAddress","isSbtBound","delegateStatus","computed","value","isVotedStatus","getVoteInfo","methods","voters","call","hasSBT","console","error","showToast","utils","isAddress","loadingToast","type","message","forbidClick","duration","send","from","gas","close","onMounted","__exports__"],"sourceRoot":""}